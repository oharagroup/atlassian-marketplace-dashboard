(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,function(e,t,n){e.exports=n(52)},,,,,,function(e,t,n){},,function(e,t,n){},,,,,,,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,,function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(10),s=n.n(o),c=n(2),u=n(3),i=n(5),l=n(4),m=n(6),d=n(1),f=n(8),h=n(7),g=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,null,[{key:"USER_NAME",get:function(){return"atlassian-id"}},{key:"PASSWORD",get:function(){return"atlassian-password"}},{key:"userName",get:function(){return window.localStorage.getItem(this.USER_NAME)},set:function(e){window.localStorage.setItem(this.USER_NAME,e)}},{key:"password",get:function(){return window.localStorage.getItem(this.PASSWORD)},set:function(e){window.localStorage.setItem(this.PASSWORD,e)}},{key:"isLoggedIn",get:function(){return!(!this.userName||!this.password)}}]),e}(),p=(n(18),function(e){function t(e){var n;Object(c.a)(this,t),n=Object(i.a)(this,Object(l.a)(t).call(this,e));var a=g.userName,r=g.password;return n.state={userName:a,password:r},n.handleUserNameChange=n.handleUserNameChange.bind(Object(d.a)(Object(d.a)(n))),n.handlePasswordChange=n.handlePasswordChange.bind(Object(d.a)(Object(d.a)(n))),n.login=n.login.bind(Object(d.a)(Object(d.a)(n))),n.cancel=n.cancel.bind(Object(d.a)(Object(d.a)(n))),n.close=n.close.bind(Object(d.a)(Object(d.a)(n))),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleUserNameChange",value:function(e){this.setState({userName:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"login",value:function(e){g.userName=this.state.userName,g.password=this.state.password,this.close(e)}},{key:"cancel",value:function(e){var t=g.userName,n=g.password;this.setState({userName:t,password:n}),this.close(e)}},{key:"close",value:function(e){e.preventDefault(),this.props.close()}},{key:"render",value:function(){var e=this.props.isOpen,t=this.state,n=t.userName,a=t.password;return g.isLoggedIn&&!e?null:r.a.createElement("form",{className:"login",onSubmit:this.login},r.a.createElement("label",null,r.a.createElement("span",null,"Atlassian ID"),r.a.createElement("input",{type:"text",value:n,onChange:this.handleUserNameChange})),r.a.createElement("label",null,r.a.createElement("span",null,"Password"),r.a.createElement("input",{type:"password",value:a,onChange:this.handlePasswordChange})),r.a.createElement("input",{type:"submit",value:"Login"}),r.a.createElement("button",{onClick:this.cancel},"Cancel"))}}]),t}(a.Component)),v=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,null,[{key:"DATE_START",get:function(){return"atlassian-marketplace-date-start"}},{key:"DATE_END",get:function(){return"atlassian-marketplace-date-end"}},{key:"yesterday",get:function(){var e=new Date;return e.setDate(e.getDate()-1),e.toISOString().substr(0,10)}},{key:"startDate",get:function(){return window.sessionStorage.getItem(this.DATE_START)||this.yesterday},set:function(e){window.sessionStorage.setItem(this.DATE_START,e)}},{key:"endDate",get:function(){return window.sessionStorage.getItem(this.DATE_END)||this.yesterday},set:function(e){window.sessionStorage.setItem(this.DATE_END,e)}}]),e}(),b=(n(20),function(e){function t(e){var n;Object(c.a)(this,t),n=Object(i.a)(this,Object(l.a)(t).call(this,e));var a=v.startDate,r=v.endDate;return n.state={startDate:a,endDate:r},n.handleStartDateChange=n.handleStartDateChange.bind(Object(d.a)(Object(d.a)(n))),n.handleEndDateChange=n.handleEndDateChange.bind(Object(d.a)(Object(d.a)(n))),n.refresh=n.refresh.bind(Object(d.a)(Object(d.a)(n))),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleStartDateChange",value:function(e){var t=e.target.value,n=this.state.endDate;t>n&&(n=""),this.setState({startDate:t,endDate:n})}},{key:"handleEndDateChange",value:function(e){var t=e.target.value,n=this.state.startDate;n>t&&(n=""),this.setState({startDate:n,endDate:t})}},{key:"refresh",value:function(e){v.startDate=this.state.startDate,v.endDate=this.state.endDate,this.props.refresh(),e.preventDefault()}},{key:"render",value:function(){var e=this.props.loading,t=this.state,n=t.startDate,a=t.endDate;return r.a.createElement("form",{className:"date-range-form",onSubmit:this.refresh},r.a.createElement("input",{type:"date",value:n,onChange:this.handleStartDateChange}),r.a.createElement("span",{className:"range-arrow"},"\u2192"),r.a.createElement("input",{type:"date",value:a,onChange:this.handleEndDateChange}),r.a.createElement("input",{className:"refresh-button ".concat(e?"loading":""),type:"submit",value:"\u21bb",disabled:!this.isRangeSet}))}},{key:"isRangeSet",get:function(){var e=this.state,t=e.startDate,n=e.endDate;return!(!t||""===t||!n||""===n)}}]),t}(a.Component)),E=n(11),O=n.n(E),y=(n(27),function(e){var t=e.logo;return r.a.createElement("img",{alt:"logo",className:"addon-logo",src:t})}),j=function(e){var t=e.amount;return r.a.createElement("div",{className:"addon-sales-amount"},0===+t||isNaN(+t)?"-":t.toLocaleString("en-au",{style:"currency",currency:"AUD"}))},D=function(e){var t=e.count;return r.a.createElement("div",{className:"addon-sales-count"},+t>0?"(".concat(t,")"):"")},k=function(e){var t=e.type;return r.a.createElement("div",{className:"addon-sales-type"},t)},N=(n(29),function(e){var t=e.logo,n=e.amount,a=e.count;return r.a.createElement("div",{className:"addon-sales-total"},r.a.createElement(y,{logo:t}),r.a.createElement(O.a,{className:"addon-sales-amount",end:n,duration:2,decimals:2,useEasing:!0,useGrouping:!0,prefix:"$"}),r.a.createElement(D,{count:a}))}),w=(n(31),function(e){var t=e.type,n=e.amount,a=e.count;return r.a.createElement("div",{className:"addon-sales-subtotal"},r.a.createElement(j,{amount:n}),r.a.createElement(k,{type:t}),r.a.createElement(D,{count:a}))}),S=(n(33),function(e){var t=e.subtotals;return r.a.createElement("div",{className:"addon-sales-subtotals"},t.map(function(e){var t=e.type,n=e.amount,a=e.count;return r.a.createElement(w,{key:t,type:t,amount:n,count:a})}))});function C(e){return e.reduce(function(e,t){return{amount:e.amount+(isNaN(t.amount)?0:+t.amount),count:e.count+(isNaN(t.count)?0:+t.count)}},{amount:0,count:0})}function U(e){return Object.keys(e).map(function(t){var n=e[t];return{type:t,amount:n.amount,count:n.count}})}function A(e,t){return t.subtotals.reduce(function(e,t){var n=t.type,a=t.amount,r=t.count,o=e[n]||{amount:0,count:0};return e[n]={amount:o.amount+(isNaN(a)?0:+a),count:o.count+(isNaN(r)?0:+r)},e},e)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.reduce(A,t)}n(35);var R=function(e){var t=e.tier,n=C(t.subtotals),a=n.amount,o=n.count;return r.a.createElement("tr",null,r.a.createElement("td",{className:"addon-sales-tier-name"},t.name),t.subtotals.map(function(e){var t=e.type,n=e.amount,a=e.count;return r.a.createElement("td",{key:t},r.a.createElement(D,{count:a}),r.a.createElement(j,{amount:n}))}),r.a.createElement("td",null,r.a.createElement(D,{count:o}),r.a.createElement(j,{amount:a})))},_=(n(37),function(e){var t=e.platform;return r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"addon-sales-tier-name"},"Tier"),r.a.createElement("th",null,"Sales"),r.a.createElement("th",null,"Renewals"),r.a.createElement("th",null,"Upgrades"),r.a.createElement("th",null,"Refunds"),r.a.createElement("th",null,"Total"))),r.a.createElement("tbody",null,t.tiers.map(function(e){return r.a.createElement(R,{key:e.name,tier:e})})))}),I=(n(39),function(e){var t=e.platform,n=U(T(t.tiers)),a=C(n),o=a.amount,s=a.count;return r.a.createElement("div",{className:"addon-sales-platform"},r.a.createElement("div",{className:"addon-sales-platform-totals"},r.a.createElement(k,{type:t.name}),r.a.createElement(j,{amount:o}),r.a.createElement(D,{count:s})),r.a.createElement(S,{subtotals:n}),r.a.createElement(_,{platform:t}))}),P=(n(41),function(e){var t=e.platforms;return r.a.createElement("div",{className:"addon-sales-platforms"},t.map(function(e){return r.a.createElement(I,{key:e.name,platform:e})}))});n(43);var L=function(e){var t=e.addon,n=U(t.platforms.reduce(function(e,t){return T(t.tiers,e)},{})),a=C(n),o=a.amount,s=a.count;return r.a.createElement("div",{className:"addon-sales-card"},r.a.createElement("h1",null,t.name),r.a.createElement(N,{logo:t.logoUrl,amount:o,count:s}),r.a.createElement(S,{subtotals:n}),r.a.createElement(P,{platforms:t.platforms}))},x=(n(45),function(e){var t=e.vendors,n=t.length>0?t[0].addons:[];return r.a.createElement("div",{className:"addon-sales-cards"},n.map(function(e){return r.a.createElement(L,{key:e.name,addon:e})}))});function M(e){var t="https://".concat("atlassian-marketplace-proxy.herokuapp.com").concat("/rest/2/"),n=g.userName,a=g.password,r=btoa("".concat(n,":").concat(a)),o={headers:{Authorization:"Basic ".concat(r)}};return fetch("".concat(t).concat(e),o).then(function(e){return e.json()})}function W(e){return e._embedded.logo._links.image.href}function B(){return M("vendors?forThisUser=true").then(function(e){var t=[],n=e._embedded.vendors.map(function(e){var n,a=e._links.self.href.match(/^\/rest\/2\/vendors\/(\d+)$/i)[1],r=e.name,o=W(e);return t.push(M("addons/vendor/".concat(n=a)).then(function(e){var t=[],a=e._embedded.addons.map(function(e){var a=e.key,r=e.name,o=W(e);return t.push(function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=v.startDate,s=v.endDate,c="vendors/".concat(t,"/reporting/sales/transactions?addon=").concat(n,"&limit=50&offset=").concat(a,"&startDate=").concat(o,"&endDate=").concat(s);return M(c).then(function(o){return o.transactions&&(r=[].concat(Object(h.a)(r),Object(h.a)(o.transactions))),o._links.next?e(t,n,a+50,r):r}).catch(console.log)}(n,a).then(z).then(G)),{name:r,logoUrl:o}});return Promise.all(t).then(function(e){return a.map(function(t,n){return Object.assign(t,{platforms:e[n]})})})})),{name:r,logoUrl:o}});return Promise.all(t).then(function(e){return n.map(function(t,n){return e[n]=e[n].sort(function(e,t){return e.name.localeCompare(t.name)}),e[n].unshift(function(e,t){var n=e.name,a=e.logoUrl,r=t.reduce(function(e,t){return t.platforms.reduce(function(e,t){var n=e[t.name]||{};return e[t.name]=t.tiers.reduce(function(e,t){var n=e[t.name]||{};return e[t.name]=A(n,t),e},n),e},e)},{});return{name:n,logoUrl:a,platforms:r=Object.keys(r).map(function(e){var t=r[e];return{name:e,tiers:Object.keys(t).map(function(e){var n=t[e];return{name:e,subtotals:Object.keys(n).map(function(e){var t=n[e];return{type:e,amount:t.amount,count:t.count}})}})}})}}(t,e[n])),Object.assign(t,{addons:e[n]})})})})}function J(){var e=v.startDate,t=v.endDate,n=[{platform:"Cloud",tiers:[]},{platform:"Server",tiers:["10","25","50","100","250","500","2000","10000","Unlimited"]},{platform:"Data Center",tiers:["500","1000","2000","3000","4000","5000","10000","15000","20000","25000","30000","35000","40000","Unlimited"]}];return e<"2017-08-01"&&(n[0].tiers=[].concat(Object(h.a)(n[0].tiers),["10","15","25","50","100","500","2000"])),t>="2017-08-01"&&(n[0].tiers=[].concat(Object(h.a)(n[0].tiers),["<=10","1-100","101-250","251-2000"])),n.reduce(function(e,t){var n=t.platform,a=t.tiers;return Object.assign(e,Object(f.a)({},n,function(e){return e.reduce(function(e,t){return Object.assign(e,Object(f.a)({},t,$()))},{})}(a)))},{})}function $(){return["New","Renewal","Upgrade","Refund"].reduce(function(e,t){return Object.assign(e,Object(f.a)({},t,{count:0,amount:0}))},{})}function z(e){return e.reduce(function(e,t){var n=t.purchaseDetails,a=n.hosting,r=n.tier,o=n.saleType,s=n.vendorAmount,c=(r=r.replace(/\sUsers/,"")).match(/Per Unit Pricing \((\d+) users\)/);return c&&c.length>=2&&!isNaN(Number(c[1]))&&(r=(c=Number(c[1]))<=10?"<=10":c<=100?"1-100":c<=250?"101-250":"251-2000"),e[a]=e[a]||{},e[a][r]=e[a][r]||$(),e[a][r][o]=e[a][r][o]||{count:0,amount:0},e[a][r][o].count++,e[a][r][o].amount+=s,e},J())}function G(e){return Object.keys(e).map(function(t){return{name:t,tiers:Object.keys(e[t]).map(function(n){return{name:n,subtotals:Object.keys(e[t][n]).map(function(a){return{type:a,amount:e[t][n][a].amount,count:e[t][n][a].count}})}})}})}var q=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,null,[{key:"refresh",value:function(){return B()}}]),e}(),F=(n(47),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(i.a)(this,Object(l.a)(t).call(this,e))).state={login:!1},n.handleSettingsClick=n.handleSettingsClick.bind(Object(d.a)(Object(d.a)(n))),n.toggleLogin=n.toggleLogin.bind(Object(d.a)(Object(d.a)(n))),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleSettingsClick",value:function(e){e.preventDefault(),this.toggleLogin()}},{key:"toggleLogin",value:function(){this.setState({login:!this.state.login})}},{key:"render",value:function(){var e=this.props,t=e.refresh,n=e.loading;return r.a.createElement("header",null,r.a.createElement(b,{refresh:t,loading:n}),r.a.createElement("button",{className:"settings-menu",onClick:this.handleSettingsClick},"\u2630"),r.a.createElement(p,{isOpen:this.state.login,close:this.toggleLogin}))}}]),t}(a.Component)),H=(n(49),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(i.a)(this,Object(l.a)(t).call(this,e))).refresh=n.refresh.bind(Object(d.a)(Object(d.a)(n))),n.state={vendors:[],loading:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.refresh()}},{key:"refresh",value:function(){var e=this;this.setState({loading:!0}),q.refresh().then(function(t){return e.setState({vendors:t,loading:!1})})}},{key:"render",value:function(){var e=this.state,t=e.vendors,n=e.loading;return r.a.createElement("div",null,r.a.createElement(F,{refresh:this.refresh,loading:n}),r.a.createElement(x,{vendors:t}))}}]),t}(a.Component));s.a.render(r.a.createElement(H,null),document.getElementById("root"))}],[[12,2,1]]]);
//# sourceMappingURL=main.b8b4dd2e.chunk.js.map